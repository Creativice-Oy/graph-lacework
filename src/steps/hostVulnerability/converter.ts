import {
  createIntegrationEntity,
  Entity,
} from '@jupiterone/integration-sdk-core';

import { Entities } from '../constants';
import { LaceworkHostVulnerability } from '../../types';

export function getHostVulnerabilityKey(
  hostname: string,
  vulnId: string,
  feature: string,
): string {
  return `lacework_host_vulnerability:${hostname}:${vulnId}:${feature}`;
}

export function createHostVulnerabilityEntity(
  hostVulnerability: LaceworkHostVulnerability,
): Entity {
  return createIntegrationEntity({
    entityData: {
      source: hostVulnerability,
      assign: {
        _key: getHostVulnerabilityKey(
          hostVulnerability.machineTags.Hostname,
          hostVulnerability.vulnId,
          JSON.stringify(hostVulnerability),
        ),
        _type: Entities.HOST_VULNERABILITY._type,
        _class: Entities.HOST_VULNERABILITY._class,

        name: hostVulnerability.vulnId || 'default',
        hostname: hostVulnerability.machineTags.Hostname,
      },
    },
  });
}
